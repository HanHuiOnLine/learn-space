<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
</head>
<style type="text/css">
	#select9891-wrap{
    height: 30px;
    width: 138px;
    border: 1px solid #ccc;
    position: relative;
    display: inline-block;
	}
	#select9891-wrap .select9891-hover-btn{
	    padding: 0 8px;
	    font-size: 14px;
	    height: 100%;
	    cursor: pointer;
	}
	#select9891-wrap .select9891-list-wrap{
	    position: absolute;
	    top: 102%;
	    left: -1px;
	    background-color: #fff;
	    border: 1px solid #ccc;
	    border-top: none;
	    width: 100%;
	    display: none;
	}
	#select9891-wrap .select9891-list-wrap li{
	    padding: 0 8px;
	    cursor: pointer;
	}
	#select9891-wrap .select9891-list-wrap li:hover{
	    background-color: #ddd;
	}
</style>
<body>
	 <div id="select9891-wrap">
        <div class="select9891-hover-btn">
            <span value="">默认为一</span>
        </div>
        <ul class="select9891-list-wrap">
        </ul>
    </div>
</body>
<script  src="http://libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
    /*
    	为了避免和其他JavaScript库冲突，我们最好将jQuery传递给一个自我执行的封闭程序，
    	jQuery在此程序中映射为$符号，这样可以避免$号被其他库覆写。
    */	
	(function ($) {
		var methods = {
			renderDom: function (arg) {
				var liDom = '';
				for (var i = 0; i < arg.length; i++) {
					liDom += '<li value="'+ arg[i].id +'">'+ arg[i].text +'</li>';
				}
				return liDom;
			},
			init: function (options) {
				var _self = this;
				//渲染数据
				//data属性和ajax属性只能有一个,也就是说,数据来源只能有一个,
				//如果两者都有,默认渲染data属性里面的数据
				if (!options.hasOwnProperty('data') && !options.hasOwnProperty('ajax')) {
					throw new Error('data属性和ajax属性必须有一个,这是数据来源');
					return false;
				}
				if (options.hasOwnProperty('data')) {
					//将本地数据加载到下拉列表
					var liDom = methods.renderDom(options.data);
					this.find('.select9891-list-wrap').html(liDom);
					//渲染完成之后,设置默认显示的值;
                    if (options.hasOwnProperty('defaultValue')) {
                        methods.setDefaultVal(_self, options.defaultValue);
                    }
				} else {
					//ajax加载远程数据
					var url      = options.ajax.url || '',
					    type     = options.ajax.type || 'get',
					    dataType = options.ajax.dataType || 'json',
                        data     = options.ajax.data || '',
                        results  = options.ajax.results;
					$.ajax({
						url: url,
						type: type,
						dataType: dataType,
						data: data,
						complete: function (XMLHttpRequest, textStatus) {
							//textStatus的值：success,notmodified,nocontent,error,timeout,abort,parsererror
							//获取数据
							var ajaxReturnData = results(textStatus, $.parseJSON(XMLHttpRequest.responseText));
							if (Array.isArray(ajaxReturnData)) {
								//渲染数据
								var liDom = methods.renderDom(ajaxReturnData);
								_self.find('.select9891-list-wrap').html(liDom);
                                //渲染完成之后,设置默认显示的值;
                                if (options.hasOwnProperty('defaultValue')) {
                                    methods.setDefaultVal(_self, options.defaultValue);
                                }
							} else {
								throw new Error('results方法返回的不是数组!');
							}
						}
					});
				}
				
				//设置placeholder
				this.find('.select9891-hover-btn > span').html(options.placeholder);

				//绑定事件
				this.on('click', '.select9891-hover-btn', function (e) {
					_self.find('.select9891-list-wrap').slideToggle('fast', 'swing');
				});
				this.on('click', '.select9891-list-wrap li', function (e) {
					var selectVal = $(this).html(),
					    selectId = $(this).attr('value');
					_self.find('.select9891-hover-btn > span').html(selectVal);
					_self.find('.select9891-hover-btn > span').attr('value', selectId);
					_self.find('.select9891-list-wrap').slideUp('fast', 'swing');
				});
			},
			setDefaultVal: function (thisT, id) {
                //设置默认值
                //需要在渲染完成之后
                /*
	                设置默认的值,需要知道数据的格式{id: 1, text: ''}
	                知道数据中的那一条是需要设置的默认值;
	            */
				var _self = thisT;
				_self.find('.select9891-list-wrap li').each(function (index, element) {
				    console.log($(element).attr('value'));
					if ($(element).attr('value') === id) {
						_self.find('.select9891-hover-btn > span').html($(element).html());
						_self.find('.select9891-hover-btn > span').attr('value', $(element).attr('value'));
					}
				});
			},
			data: function () {
			    //获取当前选中的值
				var dataDom = this.find('.select9891-hover-btn > span');
				return {
					id: dataDom.attr('value'),
					value: dataDom.html()
				}
			}
		};

		$.fn.Select9891 = function (method) {
			//方法调用
			if (methods[method]) {
            	return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        	} else if (typeof method === 'object' || !method) {
            	return methods.init.apply(this, arguments);
        	} else {
            	$.error('方法: ' + method + ' 不存在!');
        	}
		}
	})(jQuery);

</script>
<script type="text/javascript">
//	var data = [
//		{'id': 1, 'text': '11111'},
//		{'id': 2, 'text': '22222'},
//		{'id': 3, 'text': '33333'},
//		{'id': 4, 'text': '44444'}
//	];
	$('#select9891-wrap').Select9891({
		placeholder: '请选择',
		ajax: {
			url: './test.txt',
			results: function (state, response) {
                console.log(state);
                console.log(response);
			    if (state === 'success') {
			        return response.data;
                } else {
			        alert('请求出错');
                }
			}
			
		},
        //设置默认显示的值,需要知道需要显示的值的id
        defaultValue: 2
	});


	setTimeout(function () {
		//在合适的时机,获取选中的值的方法
		var a = $('#select9891-wrap').Select9891('data');
		console.log(a);
	}, 2000);
</script>
</html>