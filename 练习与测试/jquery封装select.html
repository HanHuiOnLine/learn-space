<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
</head>
<style type="text/css">
.icon {
   width: 1em; height: 1em;
   vertical-align: -0.15em;
   fill: currentColor;
   overflow: hidden;
}
	.style-css{
    height: 30px;
    width: 138px;
    border: 1px solid #ccc;
    position: relative;
    display: inline-block;
	}
	.style-css .select9891-hover-btn{
	    padding: 0 8px;
	    font-size: 14px;
	    height: 100%;
	    cursor: pointer;
	}
	.style-css .select9891-list-wrap{
	    position: absolute;
	    top: 102%;
	    left: -1px;
	    background-color: #fff;
	    border: 1px solid #ccc;
	    border-top: none;
	    width: 100%;
	    display: none;
	}
	.style-css .select9891-list-wrap li{
	    padding: 0 8px;
	    cursor: pointer;
	}
	.style-css .select9891-list-wrap li:hover{
	    background-color: #ddd;
	}
	.style-css .style-icon{
		float: right
	}	
</style>
<body>
	<!--凡是有select9891的都是有事件绑定的,设置样式时再给个class名字-->
	 <div id="select9891-wrap" class="style-css">
        <div class="select9891-hover-btn">
            <span value="">默认为一</span>
			<!--这里放上下箭头,设置class名,方便控制样式,可以随意设置样式-->
			<i class="select9891-arrow-icon style-icon">
				<svg class="icon" aria-hidden="true">
					<use xlink:href="#icon-jiantou-down"></use>
				</svg>
			</i>
        </div>
        <ul class="select9891-list-wrap">
        </ul>
    </div>
	 <div id="select9891-wrap1" class="style-css">
        <div class="select9891-hover-btn">
            <span value="">当前段位</span>
			<!--这里放上下箭头,设置class名,方便控制样式,可以随意设置样式-->
			<i class="select9891-arrow-icon style-icon">
				<svg class="icon" aria-hidden="true">
					<use xlink:href="#icon-jiantou-down"></use>
				</svg>
			</i>
        </div>
        <ul class="select9891-list-wrap">
        </ul>
    </div>
	<div>
		<button id="make-sure">确认</button>
	</div>
</body>
<script  src="http://libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
<script>
(function(window){var svgSprite='<svg><symbol id="icon-jiantou-down" viewBox="0 0 1024 1024"><path d="M534.43 774.656l479.157-479.122c13.907-13.943 13.907-36.48 0-50.422-13.943-13.943-36.515-13.943-50.458 0l-455.765 455.73-448.241-448.205c-13.516-13.551-35.446-13.551-48.961 0-13.586 13.515-13.586 35.446 0 48.995l465.464 465.5c1.819 1.819 4.030 2.71 6.133 4.030 0.82 1.105 1.248 2.461 2.282 3.495 13.907 13.907 36.48 13.907 50.387 0z"  ></path></symbol><symbol id="icon-arrow-top" viewBox="0 0 1024 1024"><path d="M519.451 256.293l-447.973 459.642 50.732 52.012 397.211-407.574 397.21 407.542 50.733-51.975z"  ></path></symbol></svg>';var script=function(){var scripts=document.getElementsByTagName("script");return scripts[scripts.length-1]}();var shouldInjectCss=script.getAttribute("data-injectcss");var ready=function(fn){if(document.addEventListener){if(~["complete","loaded","interactive"].indexOf(document.readyState)){setTimeout(fn,0)}else{var loadFn=function(){document.removeEventListener("DOMContentLoaded",loadFn,false);fn()};document.addEventListener("DOMContentLoaded",loadFn,false)}}else if(document.attachEvent){IEContentLoaded(window,fn)}function IEContentLoaded(w,fn){var d=w.document,done=false,init=function(){if(!done){done=true;fn()}};var polling=function(){try{d.documentElement.doScroll("left")}catch(e){setTimeout(polling,50);return}init()};polling();d.onreadystatechange=function(){if(d.readyState=="complete"){d.onreadystatechange=null;init()}}}};var before=function(el,target){target.parentNode.insertBefore(el,target)};var prepend=function(el,target){if(target.firstChild){before(el,target.firstChild)}else{target.appendChild(el)}};function appendSvg(){var div,svg;div=document.createElement("div");div.innerHTML=svgSprite;svgSprite=null;svg=div.getElementsByTagName("svg")[0];if(svg){svg.setAttribute("aria-hidden","true");svg.style.position="absolute";svg.style.width=0;svg.style.height=0;svg.style.overflow="hidden";prepend(svg,document.body)}}if(shouldInjectCss&&!window.__iconfont__svg__cssinject__){window.__iconfont__svg__cssinject__=true;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(e){console&&console.log(e)}}ready(appendSvg)})(window)
</script>
<script type="text/javascript">
    /*
    	为了避免和其他JavaScript库冲突，我们最好将jQuery传递给一个自我执行的封闭程序，
    	jQuery在此程序中映射为$符号，这样可以避免$号被其他库覆写。
    */	
	(function ($) {
		var methods = {
			renderDom: function (arg) {
				var liDom = '';
				for (var i = 0; i < arg.length; i++) {
					liDom += '<li value="'+ arg[i].id +'">'+ arg[i].text +'</li>';
				}
				return liDom;
			},
			init: function (options) {
				var _self = this;
				//设置placeholder
				this.find('.select9891-hover-btn > span').html(options.placeholder);
				//渲染数据
				//data属性和ajax属性只能有一个,也就是说,数据来源只能有一个,
				//如果两者都有,默认渲染data属性里面的数据
				if (!options.hasOwnProperty('data') && !options.hasOwnProperty('ajax')) {
					throw new Error('data属性和ajax属性必须有一个,这是数据来源');
					return false;
				}
				if (options.hasOwnProperty('data')) {
					//将本地数据加载到下拉列表
					var liDom = methods.renderDom(options.data);
					this.find('.select9891-list-wrap').html(liDom);
					//渲染完成之后,设置默认显示的值;
                    if (options.hasOwnProperty('defaultValue')) {
                        methods.setDefaultVal(_self, options.defaultValue);
                    }
				} else {
					//ajax加载远程数据
					var url      = options.ajax.url || '',
					    type     = options.ajax.type || 'get',
					    dataType = options.ajax.dataType || 'json',
                        data     = options.ajax.data || '',
                        results  = options.ajax.results;
					$.ajax({
						url: url,
						type: type,
						dataType: dataType,
						data: data,
						complete: function (XMLHttpRequest, textStatus) {
							//textStatus的值：success,notmodified,nocontent,error,timeout,abort,parsererror
							//获取数据
							var ajaxReturnData = results(textStatus, $.parseJSON(XMLHttpRequest.responseText));
							if (Array.isArray(ajaxReturnData)) {
								//渲染数据
								var liDom = methods.renderDom(ajaxReturnData);
								_self.find('.select9891-list-wrap').html(liDom);
                                //渲染完成之后,设置默认显示的值;
                                if (options.hasOwnProperty('defaultValue')) {
                                    methods.setDefaultVal(_self, options.defaultValue);
                                }
							} else {
								throw new Error('results方法返回的不是数组!');
							}
						}
					});
				}
				//绑定事件
				this.on('click', '.select9891-hover-btn', function (e) {
				    console.log(_self);
                    var openState = false;
                    //当参数中的canOpen设置为true时,下拉框为可打开状态
                    if (options.canOpen === true) {
                        openState = true;
                    } else {
                        //否则,下拉框的状态由enable函数控制
	                    console.log(_self.openState);
                        openState = _self.openState;
                    }
				    if (openState) {
                        _self.find('.select9891-list-wrap').slideToggle('fast', 'swing', function () {
                            //图标变换
                            methods.privateFun.changeIcon(_self);
                        });
				    }
				});
				//选中下拉框中的数据的某一个
				this.on('click', '.select9891-list-wrap li', function (e) {
					e.stopPropagation();
					var selectVal = $(this).html(),
					    selectId = $(this).attr('value');
					_self.find('.select9891-hover-btn > span').html(selectVal);
					_self.find('.select9891-hover-btn > span').attr('value', selectId);
					_self.find('.select9891-list-wrap').slideUp('fast', 'swing', function () {
						//图标变换
						methods.privateFun.changeIcon(_self);
					});
					//选中一个
					_self.trigger('choseOne');
				});
				$(document).click(function(e) {
					var target = $(e.target);
					if(target.closest(_self.selector).length == 0) {
						if (!_self.find('.select9891-list-wrap').is(':hidden')) {
							_self.find('.select9891-list-wrap').slideUp('fast', 'swing', function () {
								//图标变换
								methods.privateFun.changeIcon(_self);
							});	
						} 
					}
				});
			},
			setDefaultVal: function (thisDom, id) {
                //设置默认值,内部使用,不暴露
                //需要在渲染完成之后
                /*
	                设置默认的值,需要知道数据的格式{id: 1, text: ''}
	                知道数据中的那一条是需要设置的默认值;
	            */
				var _self = thisDom;
				_self.find('.select9891-list-wrap li').each(function (index, element) {
					if ($(element).attr('value') == id) {
						_self.find('.select9891-hover-btn > span').html($(element).html());
						_self.find('.select9891-hover-btn > span').attr('value', $(element).attr('value'));
					}
				});
			},
			data: function () {
			    //获取当前选中的值
				//可以根据返回的对象,判断是否选中了值,从而确定后面的操作
				//如果设置了默认选中的值,同理
				var dataDom = this.find('.select9891-hover-btn > span');
				return {
					id: dataDom.attr('value'),
					value: dataDom.html()
				}
			},
			open: function () {
				var _self = this;
				//open方法打开下拉框
				//用于选中第一个下拉框之后打开第二个这样的联动效果
				this.find('.select9891-list-wrap').slideDown('fast', 'swing', function () {
					//图标变换
					methods.privateFun.changeIcon(_self);
				});
			},
			enable: function (bean) {
				var _self = this;
				//控制下拉框能否被打开
				_self.openState = bean;
				console.log(_self);
            },
			reset: function () {
				//重置样式
				var _self = this;
				console.log(_self);
			},
			privateFun: {
				//下面是私有方法
				changeIcon: function (thisDom) {
					var _self = thisDom;
					var iconAttr = _self.find('i.select9891-arrow-icon use').attr('xlink:href');
					if (iconAttr === '#icon-jiantou-down') {
						_self.find('i.select9891-arrow-icon use').attr('xlink:href', '#icon-arrow-top');
					} else {
						_self.find('i.select9891-arrow-icon use').attr('xlink:href', '#icon-jiantou-down');
					}
				}
			}
		};
		$.fn.Select9891 = function (method) {
		    //拓展对象
			var _self = this;
			$.extend(_self, {openState: false});
			//方法调用
			if (methods[method]) {
            	return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        	} else if (typeof method === 'object' || !method) {
            	return methods.init.apply(this, arguments);
        	} else {
            	$.error('方法: ' + method + ' 不存在!');
        	}
		}
	})(jQuery);

</script>
<script type="text/javascript">
	var data = [
		{'id': 1, 'text': '11111'},
		{'id': 2, 'text': '22222'},
		{'id': 3, 'text': '33333'},
		{'id': 4, 'text': '44444'}
	];
	$('#select9891-wrap').Select9891({
		placeholder: '请选择',
        canOpen: true,
//		data: data,
		ajax: {
			url: './test.txt',
			results: function (state, response) {
                console.log(state);
                console.log(response);
			    if (state === 'success' && response.code === 200) {
			        return response.data;
                } else {
			        alert('请求出错');
                }
			}
		},
        //设置默认显示的值,需要知道需要显示的值的id
//        defaultValue: 2
	});
    $('#select9891-wrap1').Select9891({
        placeholder: '请选择',
        canOpen: false,
//		data: data,
        ajax: {
            url: './test.txt',
            results: function (state, response) {
                console.log(state);
                console.log(response);
                if (state === 'success') {
                    return response.data;
                } else {
                    alert('请求出错');
                }
            }
        },
//        //设置默认显示的值,需要知道需要显示的值的id
//        defaultValue: 3
    });
	
	//open方法
	
	//open方法手动打开下拉框
	//$('#select9891-wrap').Select9891('open');
	
	//选择一个
	//这个是选中一个之后发生的事件
	$('#select9891-wrap').on('choseOne', function () {
	    //选中一个后,打开后面一个,顺便将后面一个变成可下拉状态
		$('#select9891-wrap1').Select9891('open');
        $('#select9891-wrap1').Select9891('enable', true);
	});






	//
	var obj = {
	    area: {state: false, value: ''},
		server: {state: false, value: ''}
	};
	$('#make-sure').click(function () {
		console.log(22);
    });


	setTimeout(function () {
		//在合适的时机,获取选中的值的方法
		var a = $('#select9891-wrap').Select9891('data');
		console.log(a);
	}, 2000);

</script>
</html>